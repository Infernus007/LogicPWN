---
title: Authentication & Session Management
description: Comprehensive guide to authentication and session management in LogicPWN
category: Guides
sidebar:
  order: 2
---
import { Card, CardGrid, Steps, TabItem, Tabs } from '@astrojs/starlight/components';

## Overview

LogicPWN provides comprehensive authentication capabilities including session persistence, CSRF handling, and multi-step authentication flows. This guide covers implemented authentication features and best practices.

<Card title="Key Features" icon="key">
- Automatic CSRF token extraction and handling
- Session persistence and validation
- Multi-step authentication flows
- Planned: Identity provider integration (OAuth, SAML)
- JWT token management
- Enhanced security controls
- Intelligent caching with token exclusion
</Card>

## Quick Start

<Steps>
1. **Basic Authentication**

   ```python
   from logicpwn.core.auth import authenticate_session, AuthConfig

   config = AuthConfig(
       url="https://target.com/login",
       method="POST",
       credentials={"username": "admin", "password": "password"}
   )

   session = authenticate_session(config)
   ```

2. **Advanced Authentication with CSRF**

   ```python
   config = AuthConfig(
       url="https://dvwa.local/login.php",
       method="POST",
       credentials={
           "username": "admin",
           "password": "password",
           "Login": "Login"
           # user_token will be automatically extracted
       },
       success_indicators=["Welcome to DVWA"],
       failure_indicators=["Login failed"]
   )

   session = authenticate_session(config)
   ```

3. **Use Authenticated Session**

   ```python
   from logicpwn.core.runner import send_request_advanced

   result = send_request_advanced(
       session=session,
       url="https://target.com/protected/page",
       method="GET"
   )
   ```
</Steps>

## Authentication Configuration

### Basic Configuration

```python
from logicpwn.core.auth import AuthConfig

# Simple authentication
config = AuthConfig(
    url="https://example.com/login",
    method="POST",
    credentials={
        "username": "user",
        "password": "password"
    }
)
```

### Advanced Configuration

```python
# Advanced authentication with comprehensive features
config = AuthConfig(
    url="https://target.com/login.php",
    method="POST",
    credentials={
        "username": "admin",
        "password": "password",
        "Login": "Login"
    },
    timeout=30,
    verify_ssl=False,
    headers={"User-Agent": "LogicPWN/1.0"},
    success_indicators=["Welcome", "Dashboard", "Success"],
    failure_indicators=["Login failed", "Invalid", "Error"],
    csrf_config={
        "token_name": "user_token",
        "extract_from": "form"
    }
)
```

## CSRF Token Handling

LogicPWN automatically handles CSRF tokens for major frameworks:

### Supported Frameworks

<Tabs>
<TabItem label="DVWA">
```python
config = AuthConfig(
    url="http://dvwa.local/login.php",
    method="POST",
    credentials={
        "username": "admin",
        "password": "password",
        "Login": "Login"
        # user_token automatically extracted
    }
)
```
</TabItem>

<TabItem label="Rails">
```python
config = AuthConfig(
    url="https://app.com/sessions",
    method="POST",
    credentials={
        "user[email]": "user@example.com",
        "user[password]": "password"
        # authenticity_token automatically extracted
    }
)
```
</TabItem>

<TabItem label="Laravel">
```python
config = AuthConfig(
    url="https://app.com/login",
    method="POST",
    credentials={
        "email": "user@example.com",
        "password": "password"
        # _token automatically extracted
    }
)
```
</TabItem>

<TabItem label="Django">
```python
config = AuthConfig(
    url="https://app.com/login/",
    method="POST",
    credentials={
        "username": "user",
        "password": "password"
        # csrfmiddlewaretoken automatically extracted
    }
)
```
</TabItem>
</Tabs>

### Custom CSRF Configuration

```python
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "password"},
    csrf_config={
        "token_name": "custom_token",
        "extract_from": "meta",  # or "form", "input"
        "token_selector": "meta[name='csrf-token']"
    }
)
```

## Session Management

### Session Persistence

```python
# Sessions are automatically cached and validated
session = authenticate_session(config)

# Session will be reused if still valid
session2 = authenticate_session(config)  # Uses cached session

# Force new authentication
from logicpwn.core.cache import session_cache
session_cache.clear_all()
session = authenticate_session(config)  # New authentication
```

### Session Validation

```python
from logicpwn.core.auth import validate_session

# Check if session is still valid
if validate_session(session, "https://target.com/protected"):
    print("Session is valid")
else:
    print("Session expired, re-authenticating")
    session = authenticate_session(config)
```

### Manual Session Management

```python
from logicpwn.core.auth import logout_session

# Use session for requests
response = session.get("https://target.com/api/data")

# Logout when done
logout_session(session)
```

## Multi-Step Authentication

### Complex Authentication Flows

```python
from logicpwn.core.auth import Authenticator, AdvancedAuthConfig

# Configure multi-step authentication
advanced_config = AdvancedAuthConfig(
    base_config=AuthConfig(
        url="https://target.com/login",
        method="POST",
        credentials={"username": "user", "password": "password"}
    ),
    additional_steps=[
        {
            "name": "2FA",
            "url": "https://target.com/2fa",
            "method": "POST",
            "credentials": {"code": "123456"},
            "condition": lambda response: "2FA" in response.text
        }
    ]
)

authenticator = Authenticator(advanced_config)
session = authenticator.authenticate_intelligent("https://target.com/login")
```

### Conditional Authentication Steps

```python
# Authentication with conditional steps
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "password"},
    additional_steps=[
        {
            "name": "Email Verification",
            "url": "https://target.com/verify-email",
            "method": "POST",
            "credentials": {"token": "verification_token"},
            "condition": lambda response: "verify" in response.text
        }
    ]
)
```

## Identity Provider Integration (Planned)

The framework includes groundwork for identity provider (IdP) management in `logicpwn/core/auth/idp_integration.py`, but full OAuth and SAML flows are not yet implemented. This section will be updated once those features are released.

Current status:
- IdP configuration models and manager: available
- OAuth 2.0 provider flows: planned
- SAML provider flows: planned
- Example usage and guides: will be added upon implementation

## JWT Token Management

### JWT Authentication

```python
from logicpwn.core.auth import JWTConfig, JWTHandler

# Configure JWT
jwt_config = JWTConfig(
    secret_key="your-secret-key",
    algorithm="HS256",
    expiration_time=3600
)

jwt_handler = JWTHandler(jwt_config)

# Create JWT token
token = jwt_handler.create_token({"user_id": "123", "role": "admin"})

# Validate JWT token
payload = jwt_handler.validate_token(token)
```

### JWT with Session

```python
# Use JWT with session authentication
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "password"},
    jwt_config=jwt_config
)

session = authenticate_session(config)
# JWT token automatically managed
```

## Advanced Authentication Features

### Intelligent Authentication

```python
from logicpwn.core.auth import Authenticator

authenticator = Authenticator(config)

# Intelligent authentication with fallback
session = authenticator.authenticate_intelligent(
    "https://target.com/login",
    fallback_methods=["basic"]  # OAuth/SAML not implemented yet
)
```

### Authentication with Custom Headers

```python
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "password"},
    headers={
        "X-API-Key": "your-api-key",
        "X-Client-Version": "1.0",
        "User-Agent": "LogicPWN/1.0"
    }
)
```

### Authentication with Custom Timeout

```python
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "password"},
    timeout=60,  # 60 seconds timeout
    verify_ssl=False  # Skip SSL verification
)
```

## Error Handling

### Authentication Error Handling

```python
from logicpwn.exceptions import AuthenticationError

try:
    session = authenticate_session(config)
except AuthenticationError as e:
    print(f"Authentication failed: {e}")
    # Handle authentication failure
except Exception as e:
    print(f"Unexpected error: {e}")
    # Handle other errors
```

### Retry Logic

```python
import time
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=4, max=10)
)
def authenticate_with_retry(config):
    return authenticate_session(config)

# Will retry up to 3 times with exponential backoff
session = authenticate_with_retry(config)
```

## Best Practices

<CardGrid stagger>
<Card title="Use Success/Failure Indicators" icon="check">
Always specify success and failure indicators to ensure authentication worked correctly.
</Card>

<Card title="Handle CSRF Tokens" icon="shield">
Let LogicPWN automatically handle CSRF tokens for better compatibility.
</Card>

<Card title="Validate Sessions" icon="search">
Regularly validate sessions to ensure they're still active.
</Card>

<Card title="Use Appropriate Timeouts" icon="timer">
Set reasonable timeouts to avoid hanging requests.
</Card>
</CardGrid>

### 1. Success/Failure Indicators

```python
# Good: Clear indicators
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "password"},
    success_indicators=["Welcome", "Dashboard", "Success"],
    failure_indicators=["Login failed", "Invalid", "Error"]
)

# Bad: No indicators
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "password"}
)
```

### 2. Session Management

```python
# Good: Validate session before use
if validate_session(session, "https://target.com/protected"):
    response = session.get("https://target.com/api/data")
else:
    session = authenticate_session(config)

# Bad: Assume session is valid
response = session.get("https://target.com/api/data")
```

### 3. Error Handling

```python
# Good: Comprehensive error handling
try:
    session = authenticate_session(config)
    response = session.get("https://target.com/api/data")
except AuthenticationError:
    print("Authentication failed")
except requests.RequestException as e:
    print(f"Request failed: {e}")
except Exception as e:
    print(f"Unexpected error: {e}")
```

## Integration Examples

### With Access Detection

```python
from logicpwn.core.access import detect_idor_flaws
from logicpwn.core.auth import authenticate_session, AuthConfig

# Authenticate first
auth_config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "password"}
)
session = authenticate_session(auth_config)

# Use authenticated session for access detection
results = await detect_idor_flaws(
    runner=runner,
    base_url="https://target.com",
    auth_config=auth_config,
    test_endpoints=["/api/users/1", "/api/users/2"]
)
```

### With Exploit Engine

```python
from logicpwn.core.exploit_engine import ExploitEngine, ExploitChain

# Create authenticated session
session = authenticate_session(config)

# Use session in exploit chain
chain = ExploitChain(name="Authenticated Exploit")
chain.add_step(
    name="Authenticated Request",
    method="GET",
    url="https://target.com/protected",
    session=session
)

engine = ExploitEngine(runner)
results = await engine.execute_chain(chain)
```

## Troubleshooting

### Common Issues

**Authentication Failures**: Check credentials and success indicators:
```python
# Debug authentication
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "password"},
    success_indicators=["Welcome"],  # Make sure this matches
    failure_indicators=["Login failed"]
)
```

**CSRF Token Issues**: Verify token extraction:
```python
# Check if CSRF token is being extracted
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "password"},
    csrf_config={
        "token_name": "csrf_token",  # Verify token name
        "extract_from": "form"      # Verify extraction method
    }
)
```

**Session Expiration**: Implement session validation:
```python
# Check session before use
if not validate_session(session, "https://target.com/protected"):
    session = authenticate_session(config)
```

## Related Guides

<CardGrid stagger>
<Card title="Access Detection" icon="search" link="/guides/access-detection/">
Learn about IDOR vulnerability detection with authenticated sessions.
</Card>

<Card title="Async Runner" icon="rocket" link="/guides/async-runner/">
Explore high-performance request handling with authentication.
</Card>

<Card title="Exploit Engine" icon="shield" link="/guides/exploit-engine/">
Discover advanced exploit chain execution with authentication.
</Card>

<Card title="API Reference" icon="book" link="/api-reference/">
Browse the complete API documentation for authentication modules.
</Card>
</CardGrid>

## Next Steps

Now that you understand authentication in LogicPWN, you can:

1. **Integrate with Access Detection** for authenticated security testing
2. **Use with Exploit Engine** for complex authenticated attack scenarios
3. **Track Identity Provider Integration** roadmap for enterprise authentication
4. **Check out examples** in the `/examples` directory for real-world implementations
