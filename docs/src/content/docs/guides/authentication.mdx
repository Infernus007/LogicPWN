---
title: Authentication
description: Handle login, sessions, and CSRF tokens automatically
category: Guides
sidebar:
  order: 5
---

import { Card, CardGrid, Steps, TabItem, Tabs } from '@astrojs/starlight/components';

## Quick Start

LogicPWN handles authentication automatically, including CSRF tokens and session management.

```python
from logicpwn.core.auth import authenticate_session, AuthConfig

# Basic authentication
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "admin", "password": "password"}
)

session = authenticate_session(config)
```

## Using Authenticated Sessions

<Tabs>
<TabItem label="With HttpRunner">
```python
from logicpwn.core.runner import HttpRunner

# Use authenticated session with HttpRunner
runner = HttpRunner()
runner.session = session

# Make authenticated requests
result = runner.get("https://target.com/protected")
```
</TabItem>
<TabItem label="Direct Session">
```python
# Use session directly
response = session.get("https://target.com/protected")
print(response.status_code)
```
</TabItem>
</Tabs>

## CSRF Token Handling

LogicPWN automatically extracts and handles CSRF tokens:

```python
# DVWA example with automatic CSRF token extraction
config = AuthConfig(
    url="https://dvwa.local/login.php",
    method="POST",
    credentials={
        "username": "admin",
        "password": "password",
        "Login": "Login"
        # user_token will be automatically extracted and added
    },
    success_indicators=["Welcome to DVWA"],
    failure_indicators=["Login failed"]
)

session = authenticate_session(config)
```

## Advanced Configuration

```python
# Comprehensive authentication setup
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={
        "username": "admin",
        "password": "password"
    },
    # Success/failure detection
    success_indicators=["Welcome", "Dashboard", "Logout"],
    failure_indicators=["Login failed", "Invalid credentials"],

    # Request settings
    timeout=30,
    verify_ssl=True,
    headers={"User-Agent": "LogicPWN/1.0"},

    # CSRF handling
    csrf_config={
        "enabled": True,
        "token_patterns": [
            r'name="([^"]*token[^"]*)"\s+value="([^"]+)"',
            r'<meta\s+name="csrf-token"\s+content="([^"]+)"'
        ]
    }
)

session = authenticate_session(config)
```

## Session Validation

```python
from logicpwn.core.auth import validate_session

# Check if session is still valid
if validate_session(session, "https://target.com/protected"):
    print("Session is valid")
else:
    print("Session expired, re-authenticate")
```

## Common Patterns

<CardGrid>
<Card title="DVWA Authentication" icon="shield">
```python
# DVWA with CSRF token handling
config = AuthConfig(
    url="http://dvwa.local/login.php",
    method="POST",
    credentials={
        "username": "admin",
        "password": "password",
        "Login": "Login"
    },
    success_indicators=["Welcome to DVWA"],
    failure_indicators=["Login failed"]
)
```
</Card>

<Card title="Multi-Step Login" icon="key">
```python
# Multi-step authentication flow
config = AuthConfig(
    url="https://target.com/login",
    method="POST",
    credentials={"username": "user", "password": "pass"},
    # Handle redirects and multi-step flows
    follow_redirects=True,
    max_redirects=5
)
```
</Card>

<Card title="Session Persistence" icon="save">
```python
# Sessions are automatically cached and reused
# Subsequent calls with same credentials use cached session
session = authenticate_session(config)  # Uses cache if available
```
</Card>
</CardGrid>

## JWT Token Management

```python
from logicpwn.core.auth import JWTHandler, JWTConfig

# JWT token handling
jwt_config = JWTConfig(
    secret_key="your-secret-key",
    algorithm="HS256"
)

jwt_handler = JWTHandler(jwt_config)

# Create token
token = jwt_handler.create_token({"user_id": "123", "role": "admin"})

# Verify token
claims = jwt_handler.verify_token(token)
print(claims["user_id"])  # 123
```

## Identity Provider Integration

```python
from logicpwn.core.auth import IdPManager, IdPConfig

# OAuth/SAML integration
idp_config = IdPConfig(
    provider_type="oauth",
    client_id="your-client-id",
    client_secret="your-client-secret",
    authorization_url="https://provider.com/oauth/authorize",
    token_url="https://provider.com/oauth/token"
)

idp_manager = IdPManager(idp_config)
auth_session = idp_manager.authenticate()
```

## Best Practices

1. **Use success/failure indicators** to verify authentication
2. **Enable CSRF protection** for applications that require it
3. **Set appropriate timeouts** for slow authentication endpoints
4. **Validate sessions** before making protected requests
5. **Handle authentication errors** gracefully
6. **Use session caching** to avoid repeated logins

## Troubleshooting

- **Authentication fails**: Check credentials and success indicators
- **CSRF errors**: Ensure CSRF patterns match your application
- **Session expires**: Implement session validation and re-authentication
- **Redirect loops**: Adjust `max_redirects` setting
- **SSL errors**: Set `verify_ssl=False` for testing (not recommended for production)
